<!DOCTYPE html>
<html lang="en" x-data="dashboardApp()" x-init="init()">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Deemind Observatory â€” Local Dashboard</title>
  <link rel="stylesheet" href="./dashboard.css" />
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.6/dist/chart.umd.min.js"></script>
</head>
<body class="bg-slate-950 text-slate-100">
  <div class="min-h-screen flex flex-col">
    <header class="sticky top-0 bg-slate-950/90 backdrop-blur border-b border-slate-800 z-10">
      <div class="max-w-7xl mx-auto px-6 py-4 flex flex-wrap items-center gap-4 justify-between">
        <div>
          <p class="text-xs uppercase tracking-[0.3em] text-slate-400">Deemind Observatory</p>
          <h1 class="text-2xl font-semibold">ðŸ§  Deemind / Codex Local Dashboard</h1>
        </div>
        <div class="flex items-center gap-3 text-sm">
          <span class="badge badge-success">Local Only</span>
          <span class="badge" x-text="`UI v${uiVersion}`"></span>
          <span class="badge badge-muted" x-text="lastSyncedLabel"></span>
          <button class="btn" @click="refresh()">Refresh âŸ³</button>
        </div>
      </div>
      <nav class="overflow-x-auto border-t border-slate-900">
        <div class="max-w-7xl mx-auto px-6 py-3 flex gap-4 text-sm whitespace-nowrap">
          <a href="#system" class="nav-link">System Summary</a>
          <a href="#themes" class="nav-link">Themes & Builds</a>
          <a href="#harmony" class="nav-link">Harmony & Validation</a>
          <a href="#docs" class="nav-link">Docs & Coverage</a>
          <a href="#custom" class="nav-link">Customization</a>
          <a href="#performance" class="nav-link">Performance</a>
          <a href="#agent" class="nav-link">Agent & Directives</a>
          <a href="#logs" class="nav-link">Logs</a>
        </div>
      </nav>
    </header>

    <main class="flex-1">
      <section id="system" class="section">
        <div class="section-header">
          <h2>System Summary</h2>
          <p>High-level health indicators pulled from system-status.json and harmony reports.</p>
        </div>
        <div class="grid gap-6 md:grid-cols-4">
          <div class="card" aria-live="polite">
            <p class="card-label">Global Health</p>
            <p class="card-value" x-text="`${healthScore.toFixed(1)}%`"></p>
            <div class="progress">
              <div class="progress-bar" :style="{ width: `${healthScore}%` }"></div>
            </div>
            <p class="card-meta">Composite of harmony, docs, CI status.</p>
          </div>
          <div class="card">
            <p class="card-label">Harmony Score</p>
            <p class="card-value" x-text="`${harmonyAverage.toFixed(1)} / 100`"></p>
            <p class="card-meta" x-text="`Themes tracked: ${themes.length}`"></p>
          </div>
          <div class="card">
            <p class="card-label">Docs Coverage</p>
            <p class="card-value" x-text="`${docsCoverage}%`"></p>
            <p class="card-meta">Based on docs index + directives</p>
          </div>
          <div class="card">
            <p class="card-label">CI Duration</p>
            <p class="card-value" x-text="ciSummary"></p>
            <p class="card-meta">Last workflow run</p>
          </div>
        </div>
      </section>

      <section id="themes" class="section">
        <div class="section-header">
          <h2>Themes & Builds</h2>
          <p>Status, validation links, and preview thumbnails for each tracked theme.</p>
        </div>
        <div class="grid gap-6 md:grid-cols-2 xl:grid-cols-3">
          <template x-for="theme in themes" :key="theme.name">
            <article class="card flex flex-col gap-4">
              <div class="flex items-center justify-between">
                <div>
                  <h3 class="text-lg font-semibold" x-text="theme.name"></h3>
                  <p class="text-slate-400 text-sm" x-text="theme.statusLabel"></p>
                </div>
                <span class="badge" :class="theme.badgeClass" x-text="theme.scoreText"></span>
              </div>
              <div class="rounded-lg bg-slate-900/60 border border-slate-800 overflow-hidden">
                <img :src="theme.preview" :alt="`${theme.name} preview`" class="w-full h-40 object-cover bg-slate-900" loading="lazy" onerror="this.onerror=null; this.src='data:image/svg+xml;utf8,<svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;400&quot; height=&quot;160&quot;><rect width=&quot;100%&quot; height=&quot;100%&quot; fill=&quot;%23111&quot;/><text x=&quot;50%&quot; y=&quot;50%&quot; fill=&quot;%23aaa&quot; font-size=&quot;18&quot; font-family=&quot;Inter,Arial&quot; dominant-baseline=&quot;middle&quot; text-anchor=&quot;middle&quot;>preview unavailable</text></svg>'" />
              </div>
              <div class="flex flex-wrap gap-2 text-sm">
                <a :href="theme.buildReport" target="_blank" class="link">ðŸ§± Build Report</a>
                <a :href="theme.validateReport" target="_blank" class="link">âœ… Validate</a>
                <a :href="theme.themeJson" target="_blank" class="link">ðŸ“„ theme.json</a>
                <a :href="theme.visualDir" target="_blank" class="link">ðŸ“· Visuals</a>
              </div>
            </article>
          </template>
        </div>
      </section>

      <section id="harmony" class="section">
        <div class="section-header">
          <h2>Harmony & Validation</h2>
          <p>Live scores, schema drift, and validation summaries.</p>
        </div>
        <div class="grid gap-6 lg:grid-cols-2">
          <div class="card">
            <div class="flex items-center justify-between">
              <h3 class="text-lg font-semibold">Harmony Trend</h3>
              <span class="badge badge-muted">Chart.js</span>
            </div>
            <canvas id="harmonyChart" height="200"></canvas>
          </div>
          <div class="card">
            <h3 class="text-lg font-semibold mb-2">Schema Drift</h3>
            <p class="text-sm text-slate-400 mb-4">Differences detected between generated theme schema and Salla baseline.</p>
            <ul class="space-y-2 text-sm">
              <template x-if="schemaDrift.length">
                <template x-for="item in schemaDrift" :key="item.title">
                  <li class="drift-item">
                    <div>
                      <p class="font-semibold" x-text="item.title"></p>
                      <p class="text-slate-400" x-text="item.detail"></p>
                    </div>
                    <span class="badge badge-warning" x-text="item.level"></span>
                  </li>
                </template>
              </template>
              <template x-if="!schemaDrift.length">
                <li class="drift-item">
                  <p class="text-slate-300">No drift detected.</p>
                </li>
              </template>
            </ul>
          </div>
        </div>
      </section>

      <section id="docs" class="section">
        <div class="section-header">
          <h2>Docs & Coverage</h2>
          <p>Documentation inventory and missing references.</p>
        </div>
        <div class="card">
          <div class="flex flex-wrap gap-4 text-sm">
            <div>
              <p class="text-slate-400 uppercase tracking-wide text-xs">Docs tracked</p>
              <p class="text-2xl font-semibold" x-text="docStats.count"></p>
            </div>
            <div>
              <p class="text-slate-400 uppercase tracking-wide text-xs">Directives</p>
              <p class="text-2xl font-semibold" x-text="docStats.directives"></p>
            </div>
            <div>
              <p class="text-slate-400 uppercase tracking-wide text-xs">Reports</p>
              <p class="text-2xl font-semibold" x-text="docStats.reports"></p>
            </div>
          </div>
          <div class="mt-6">
            <h3 class="font-semibold mb-2">Missing / Drift</h3>
            <ul class="list-disc list-inside text-sm text-slate-300 space-y-1">
              <template x-if="docStats.missing.length">
                <template x-for="item in docStats.missing" :key="item">
                  <li x-text="item"></li>
                </template>
              </template>
              <template x-if="!docStats.missing.length">
                <li>Documentation synced.</li>
              </template>
            </ul>
          </div>
        </div>
      </section>

      <section id="custom" class="section">
        <div class="section-header">
          <h2>Customization Requests</h2>
          <p>Live view of /logs/customization-requests.json.</p>
        </div>
        <div class="card overflow-x-auto">
          <table class="w-full text-sm">
            <thead>
              <tr class="text-left text-slate-400 uppercase text-xs">
                <th class="py-2">Title</th>
                <th class="py-2">Status</th>
                <th class="py-2">Theme</th>
                <th class="py-2">Last Updated</th>
              </tr>
            </thead>
            <tbody>
              <template x-if="customRequests.length">
                <template x-for="req in customRequests" :key="req.id">
                  <tr class="border-t border-slate-800">
                    <td class="py-2" x-text="req.title"></td>
                    <td class="py-2">
                      <span class="badge" :class="req.badge" x-text="req.status"></span>
                    </td>
                    <td class="py-2" x-text="req.target || 'â€”'"></td>
                    <td class="py-2" x-text="req.updated"></td>
                  </tr>
                </template>
              </template>
              <template x-if="!customRequests.length">
                <tr>
                  <td class="py-4 text-center text-slate-400" colspan="4">No customization requests logged.</td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </section>

      <section id="performance" class="section">
        <div class="section-header">
          <h2>Performance & Lighthouse</h2>
          <p>Metrics parsed from /reports/lighthouse/ and visual regression outputs.</p>
        </div>
        <div class="grid gap-6 md:grid-cols-2">
          <div class="card">
            <h3 class="text-lg font-semibold mb-4">Lighthouse Scores</h3>
            <ul class="space-y-3">
              <template x-if="lighthouse.length">
                <template x-for="entry in lighthouse" :key="entry.name">
                  <li class="flex items-center justify-between">
                    <div>
                      <p class="font-medium" x-text="entry.name"></p>
                      <p class="text-slate-400 text-sm" x-text="entry.updated"></p>
                    </div>
                    <span class="badge" :class="entry.badge" x-text="entry.score"></span>
                  </li>
                </template>
              </template>
              <template x-if="!lighthouse.length">
                <li class="text-slate-400 text-sm">No Lighthouse reports yet.</li>
              </template>
            </ul>
          </div>
          <div class="card">
            <h3 class="text-lg font-semibold mb-4">Visual Regression</h3>
            <p class="text-sm text-slate-400 mb-2">Screenshots stored under /reports/visual/</p>
            <div class="flex flex-wrap gap-3">
              <template x-for="shot in visualReports" :key="shot.name">
                <a :href="shot.path" target="_blank" class="visual-thumb">
                  <span x-text="shot.name"></span>
                </a>
              </template>
              <template x-if="!visualReports.length">
                <p class="text-slate-400 text-sm">No captures yet.</p>
              </template>
            </div>
          </div>
        </div>
      </section>

      <section id="agent" class="section">
        <div class="section-header">
          <h2>Agent & Directives</h2>
          <p>Active directives, bridge files, and scheduler status.</p>
        </div>
        <div class="grid gap-6 lg:grid-cols-2">
          <div class="card">
            <h3 class="text-lg font-semibold mb-3">Active Directives</h3>
            <ul class="space-y-2 text-sm">
              <template x-for="directive in directives" :key="directive.name">
                <li class="directive">
                  <div>
                    <p class="font-medium" x-text="directive.name"></p>
                    <p class="text-slate-400" x-text="directive.summary"></p>
                  </div>
                  <a :href="directive.path" target="_blank" class="link">Open</a>
                </li>
              </template>
            </ul>
          </div>
          <div class="card">
            <h3 class="text-lg font-semibold mb-3">Recent Codex Tasks</h3>
            <ul class="space-y-2 text-sm">
              <template x-if="taskLog.length">
                <template x-for="task in taskLog" :key="task.time">
                  <li class="directive">
                    <div>
                      <p class="font-medium" x-text="task.task"></p>
                      <p class="text-slate-400" x-text="task.target || 'â€”'"></p>
                    </div>
                    <span class="badge" :class="task.badge" x-text="task.status"></span>
                  </li>
                </template>
              </template>
              <template x-if="!taskLog.length">
                <li class="text-slate-400">No recent tasks logged.</li>
              </template>
            </ul>
          </div>
        </div>
      </section>

      <section id="logs" class="section">
        <div class="section-header">
          <h2>System Logs</h2>
          <p>Latest entries from /logs/system-status.log (tail view).</p>
        </div>
        <div class="card">
          <pre class="log-panel" x-text="systemLog || 'No logs found.'"></pre>
        </div>
      </section>
    </main>

    <footer class="border-t border-slate-900 text-center text-xs text-slate-500 py-6">
      Generated locally â€¢ Data pulled directly from repo files â€¢ Last refresh:
      <span x-text="lastSyncedLabel"></span>
    </footer>
  </div>

  <script type="module" src="./dashboard.js"></script>
</body>
</html>
