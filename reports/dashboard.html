<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Deemind / Codex Dashboard</title>
  <style>
    body {
      font-family: Inter, system-ui, sans-serif;
      background: #f5f7fb;
      color: #11224e;
      margin: 0;
      padding: 2rem;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }
    h1 { font-size: 1.8rem; margin: 0; }
    .badge {
      background: #0046ff;
      color: #fff;
      padding: 0.3rem 0.7rem;
      border-radius: 0.5rem;
      font-size: 0.8rem;
      text-transform: uppercase;
    }
    section { margin-bottom: 2rem; }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      border-radius: 0.75rem;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    th, td {
      padding: 0.75rem 1rem;
      text-align: left;
    }
    th { background: #e9eef9; }
    tr:nth-child(even) td { background: #fafbff; }
    a {
      color: #0046ff;
      text-decoration: none;
      font-weight: 500;
    }
    a:hover { text-decoration: underline; }
    footer {
      font-size: 0.85rem;
      color: #666;
      text-align: center;
      margin-top: 3rem;
    }
  </style>
  <!-- Lightweight dashboard: client-side only -->
</head>
<body>
  <header>
    <h1>ðŸ§  Deemind / Codex Dashboard</h1>
    <span class="badge">Autonomous Mode</span>
  </header>

  <section>
    <h2>ðŸ“¸ Theme Previews</h2>
    <div id="theme-gallery" style="
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 1.5rem;">
    </div>
  </section>

  <section>
    <h2>ðŸ“Š Harmony Trend</h2>
    <canvas id="trend" height="120"></canvas>
  </section>

  <section>
    <h2>ðŸŽ¨ Mock-Ups</h2>
    <table id="mockups">
      <thead><tr><th>Theme</th><th>Report</th><th>Updated</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <section>
    <h2>ðŸ§© Codex Tasks Log</h2>
    <table id="tasks">
      <thead><tr><th>Task</th><th>Target</th><th>Status</th><th>Timestamp</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <footer>
    Generated by Deemind x Codex â€¢ Reports auto-refresh when re-opened in browser.
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    async function fetchJSON(path) {
      try { const res = await fetch(path); if (res.ok) return await res.json(); }
      catch { return null; }
      return null;
    }

    function addRow(tableId, cols) {
      const row = document.createElement('tr');
      cols.forEach(c => {
        const td = document.createElement('td');
        td.innerHTML = c;
        row.appendChild(td);
      });
      document.querySelector(`#${tableId} tbody`).appendChild(row);
    }

    async function loadGallery() {
      const themes = ['demo','gimni','modern','salla-new-theme','animal'];
      const harmony = await fetchJSON('harmony-summary.json');
      const scores = (harmony && harmony.scores) || {};

      const gallery = document.getElementById('theme-gallery');
      gallery.innerHTML = '';

      themes.forEach(name => {
        const previewPath = `visual/${name}/latest.png`;
        const score = scores[name]?.score ?? 'â€“';
        const statusColor = typeof score === 'number'
          ? (score >= 95 ? '#28a745' : score >= 80 ? '#ffc107' : '#e55353')
          : '#999';

        const card = document.createElement('div');
        card.style.cssText = `
          background:#fff;
          border-radius:1rem;
          box-shadow:0 2px 8px rgba(0,0,0,0.05);
          overflow:hidden;
          transition:transform .2s;
        `;
        card.onmouseenter = () => card.style.transform = 'scale(1.02)';
        card.onmouseleave = () => card.style.transform = 'scale(1)';

        card.innerHTML = `
          <img src="${previewPath}" alt="${name} preview"
               style="width:100%;height:200px;object-fit:cover;background:#fafafa">
          <div style="padding:1rem">
            <h3 style="margin:0 0 .5rem;text-transform:capitalize">${name}</h3>
            <p style="margin:0;font-size:.9rem;color:#555">
              Harmony Score: <strong style="color:${statusColor}">${score}</strong>
            </p>
            <div style="margin-top:.5rem;display:flex;gap:.5rem;flex-wrap:wrap">
              <a href="build-${name}.md" target="_blank">ðŸ§± Build Report</a>
              <a href="validate-${name}.md" target="_blank">âœ… Validate</a>
              <a href="visual/${name}/" target="_blank">ðŸ“· Screens</a>
              <a href="../output/${name}/theme.json" target="_blank">ðŸ§¾ theme.json</a>
            </div>
          </div>`;
        gallery.appendChild(card);
      });
    }

    async function loadTasks() {
      const tasks = await fetchJSON('../logs/codex-tasks.json');
      if (tasks && Array.isArray(tasks) && tasks.length) {
        tasks.slice(-10).reverse().forEach(t => {
          addRow('tasks', [
            t.task || 'â€”',
            t.target || 'â€”',
            t.status ? `<span style="color:${t.status==='success'?'#28a745':'#e55353'}">${t.status}</span>` : 'â€”',
            (t.time ? new Date(t.time).toLocaleString() : new Date().toLocaleString())
          ]);
        });
      } else addRow('tasks', ['No log found', '', '', '']);
    }

    async function loadMockups() {
      addRow('mockups', [
        'modern-blue',
        `<a href="mockup-modern-blue.md" target="_blank">Report</a>`,
        new Date().toLocaleDateString()
      ]);
    }

    async function drawTrend() {
      const harmony = await fetchJSON('harmony-summary.json');
      if (!harmony) return;
      const labels = Object.keys(harmony.scores || {});
      const data = labels.map(label => harmony.scores[label]?.score ?? 0);
      const ctx = document.getElementById('trend').getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [{
            label: 'Harmony Score',
            data,
            borderColor: '#0046ff',
            backgroundColor: 'rgba(0,70,255,0.1)',
            tension: .3
          }]
        },
        options: {
          scales: {
            y: { min: 0, max: 100 }
          }
        }
      });
    }

    async function init() {
      await loadGallery();
      await loadTasks();
      await loadMockups();
      await drawTrend();
    }
    init();
  </script>
</body>
</html>
